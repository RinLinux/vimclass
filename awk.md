# AWK

### awk简介

awk 是一种很棒的语言，它适合文本处理和报表生成，其语法较为常见，借鉴了某些语言的一些精华，如 C 语言等。在 linux 系统日常处理工作中，发挥很重要的作用，掌握了 awk将会使你的工作变的高大上。

现在常用的是Unix系统中原始的awk的GNU版本gawk。

在awk中可以完成以下工作：

+ 定义变量来保存数据
+ 使用算术和字符串操作符来处理数据
+ 使用结构化编程概念来增加处理逻辑
+ 通过提取数据文件中的数据元素，将其格式化排列，生成报告

#### awk使用方法

```shell
awk '{pattern + action}' filename
```

其中 pattern 表示 AWK 在数据中查找的内容，而 action 是在找到匹配内容时所执行的一系列命令。花括号（{}）不需要在程序中始终出现，但它们用于根据特定的模式对一系列指令进行分组。 pattern就是要表示的正则表达式，用斜杠括起来。

awk语言的最基本功能是在文件或者字符串中基于指定规则浏览和抽取信息，**awk**抽取信息后，才能进行其他文本操作。完整的**awk**脚本通常用来格式化文本文件中的信息。

通常，**awk**是以文件的一行为处理单位的。**awk**每接收文件的一行，然后执行相应的命令，来处理文本。

###### awk程序的基本格式如下：

```shell
awk options program file
```

常用的选项（options）包括：

+ **-F** fs, 指定行中划分数据字段的字段分隔符
+ **-f** file, 从指定的呃呃文件中读取程序

###### 使用数据字段变量

**awk**会根据内部变量FS将每一行进行分割，然后自动给一行中的没一个数据元素分配一个变量，默认情况下会按照以下方式分配变量：

+ **$0** 代表整个文本行
+ **$1**代表文本行中的第1个数据字段
+ **$2**代表文本行中的第2个数据字段
+ **$n**代表文本行中的第n个数据字段

通常使用**FS**变量或者-F指定数据字段的字段分隔符，默认情况为空格或者制表符

###### 在程序中使用多个命令

**awk**允许将多个命令组合成一个正常的程序，在命令之间添加分号就可以，另外可以将程序保存在文件中，然后在命令行中引用，使用**-f**选项即可。

```shell
$ cat code.awk
! /^#/ {print $1,$6}
```

```shell
$ awk -F":" -f code.awk /etc/passwd
nobody /var/empty
root /var/root
daemon /var/root
_uucp /var/spool/uucp
_taskgated /var/empty
```

###### **BEGIN** 和 **END** 模块

通常，对于每个输入行， awk 都会执行每个脚本代码块一次。然而，在许多编程情况中，可能需要在 awk 开始处理输入文件中的文本之前执行初始化代码。对于这种情况， **awk** 允许您定义一个 **BEGIN** 块。

因为 **awk** 在开始处理输入文件之前会执行 **BEGIN** 块，因此它是初始化**FS**（字段分隔符）变量、打印页眉或初始化其它在程序中以后会引用的全局变量的极佳位置。
**awk** 还提供了另一个特殊块，叫作 **END** 块。 **awk** 在处理了输入文件中的所有行之后执行这个块。通常， **END** 块用于执行最终计算或打印应该出现在输出流结尾的摘要信息。

因此相对完成的代码可以表述为：

```shell
awk options 'BEGIN{} {} END{}' filename
```

###### 常用**awk**内置变量

**awk**内置变量可以用在所有的表达式中，而且可以被用户重置。每当有一个新的文件被读取**FILENAME**就会被重新赋值每当有一个新的记录被读进来**FNR**，**NF**，NR就会被重新赋值。另外，当$0发生改变或有新的字段被创建时**NF**就被重置。

| 变量         | 意义                     | 默认值 |
| ------------ | ------------------------ | ------ |
| **ARGC**     | 命令行参数的个数         | -      |
| **ARGV**     | 命令行参数数组           | -      |
| **FILENAME** | 当前输入文件名           | -      |
| **FNR**      | 当前输入文件的记录个数   | -      |
| **FS**       | 输入行的字段分隔符       | " "    |
| **RS**       | 输入行的记录分隔符       | "\n"   |
| **OFS**      | 输出字段分隔符           | " "    |
| **ORS**      | 输出记录的分隔符         | "\n"   |
| **NR**       | 到目前为止读的记录的数量 | -      |



















参考资料：

+ https://www.cnblogs.com/ginvip/p/6352157.html
+ https://github.com/wuzhouhui/awk

